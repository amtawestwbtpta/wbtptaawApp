<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WB Employee & Teacher Application Writing Tool</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <!-- Google Fonts - Merriweather (for headings) & Open Sans (for body) -->
    <link href="https://fonts.googleapis.com/css2?family=Merriweather:wght@700&family=Open+Sans:wght@400;600&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Open Sans', sans-serif; /* Office-like body font */
        }
        h1, h2 {
            font-family: 'Merriweather', serif; /* Elegant heading font */
        }
        /* Custom print styles */
        @media print {
            body * {
                visibility: hidden;
            }
            #print-area, #print-area * {
                visibility: visible;
            }
            #print-area {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
                padding: 20mm; /* Add some margin for printing */
                box-sizing: border-box;
                font-size: 12pt;
                line-height: 1.5;
            }
            #print-area pre {
                white-space: pre-wrap; /* Ensure text wraps */
                word-wrap: break-word;
            }
        }
    </style>
</head>
<body class="min-h-screen bg-gray-50 flex items-center justify-center p-4 sm:p-6 lg:p-8">
<div class="bg-white p-6 sm:p-8 lg:p-10 rounded-xl shadow-2xl w-full max-w-5xl transition-all duration-300 border border-gray-200">
    <h1 class="text-3xl sm:text-4xl font-bold text-center text-blue-800 mb-8 rounded-lg p-3 bg-blue-50 border border-blue-200">
        WB Employee & Teacher Application Writing Tool
    </h1>

    <!-- Language Selection -->
    <div class="mb-8 p-5 bg-gray-50 rounded-lg border border-gray-200 shadow-sm">
        <h2 class="text-xl font-semibold text-gray-800 mb-4" id="language-heading">Select Language:</h2>
        <div class="flex flex-wrap gap-6">
            <label class="inline-flex items-center cursor-pointer group">
                <input
                        type="radio"
                        class="form-radio h-5 w-5 text-blue-600 rounded-full focus:ring-2 focus:ring-blue-500"
                        name="language"
                        value="english"
                        checked
                />
                <span class="ml-3 text-lg text-gray-700 group-hover:text-blue-700 transition-colors duration-200">English</span>
            </label>
            <label class="inline-flex items-center cursor-pointer group">
                <input
                        type="radio"
                        class="form-radio h-5 w-5 text-blue-600 rounded-full focus:ring-2 focus:ring-blue-500"
                        name="language"
                        value="bengali"
                />
                <span class="ml-3 text-lg text-gray-700 group-hover:text-blue-700 transition-colors duration-200">বাংলা</span>
            </label>
        </div>
    </div>

    <!-- Search Application Type -->
    <div class="mb-8 p-5 bg-gray-50 rounded-lg border border-gray-200 shadow-sm">
        <label for="app-search" class="block text-xl font-semibold text-gray-800 mb-3" id="search-heading">Search Application:</label>
        <input
                type="text"
                id="app-search"
                placeholder="Type to search application types..."
                class="w-full p-3 border border-gray-300 rounded-lg focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-200 text-base"
        />
    </div>

    <!-- Application Type Selection -->
    <div class="mb-8 p-5 bg-blue-50 rounded-lg border border-blue-200 shadow-md">
        <h2 class="text-xl font-semibold text-blue-800 mb-4" id="application-type-heading">Select Application Type:</h2>
        <div class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-4 transition-all duration-300" id="application-type-radios">
            <!-- Radio buttons will be dynamically inserted here by JavaScript -->
        </div>
    </div>

    <!-- Dynamic Input Fields Container -->
    <div id="dynamic-inputs-container" class="mb-8 p-6 border border-green-200 rounded-lg bg-green-50 shadow-md transition-all duration-300">
        <h2 class="text-xl font-semibold text-green-800 mb-4" id="input-fields-heading">Enter Application Details:</h2>
        <!-- Input fields will be dynamically inserted here by JavaScript -->
    </div>

    <!-- Generated Application Text -->
    <div class="mb-8 p-6 bg-gray-50 rounded-lg border border-gray-200 shadow-md">
        <h2 class="text-xl font-semibold text-gray-800 mb-4" id="generated-application-heading">Generated Application:</h2>
        <textarea
                id="application-text"
                class="w-full p-4 border border-gray-300 rounded-lg bg-white text-gray-800 text-base resize-y min-h-[300px] focus:outline-none focus:ring-2 focus:ring-blue-500 transition-all duration-300 font-mono leading-relaxed"
                readonly
                rows="15"
        ></textarea>
    </div>

    <!-- Action Buttons -->
    <div class="flex flex-col sm:flex-row items-center justify-center gap-4">
        <button
                id="copy-button"
                class="px-8 py-3 bg-indigo-600 text-white font-bold rounded-full shadow-lg hover:bg-indigo-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:ring-offset-2 w-full sm:w-auto transform hover:scale-105"
        >
            Copy Application
        </button>
        <button
                id="print-button"
                class="px-8 py-3 bg-purple-600 text-white font-bold rounded-full shadow-lg hover:bg-purple-700 transition-all duration-300 focus:outline-none focus:ring-2 focus:ring-purple-500 focus:ring-offset-2 w-full sm:w-auto transform hover:scale-105"
        >
            Print Application
        </button>
        <p id="copy-message" class="mt-3 sm:mt-0 text-sm text-green-700 font-medium"></p>
    </div>
</div>

<script>
    // Get references to DOM elements
    const languageRadios = document.querySelectorAll('input[name="language"]');
    const appSearchInput = document.getElementById('app-search');
    const applicationTypeRadiosContainer = document.getElementById('application-type-radios');
    const dynamicInputsContainer = document.getElementById('dynamic-inputs-container');
    const applicationTextarea = document.getElementById('application-text');
    const copyButton = document.getElementById('copy-button');
    const printButton = document.getElementById('print-button');
    const copyMessage = document.getElementById('copy-message');

    const languageHeading = document.getElementById('language-heading');
    const searchHeading = document.getElementById('search-heading');
    const applicationTypeHeading = document.getElementById('application-type-heading');
    const inputFieldsHeading = document.getElementById('input-fields-heading');
    const generatedApplicationHeading = document.getElementById('generated-application-heading');

    // State variables
    let selectedApplicationType = 'casualLeave';
    let currentLanguage = 'english';
    let formData = {}; // Stores values from dynamic input fields

    // Define application types with their names and placeholders
    const applicationTypes = [
        {
            id: 'casualLeave',
            name: { english: 'Casual Leave (CL)', bengali: 'নৈমিত্তিক ছুটি (CL)' },
            placeholders: [
                { id: 'authorityDesignation', label: { english: 'Authority Designation', bengali: 'কর্তৃপক্ষের পদবি' }, type: 'text', default: 'Headmaster/Principal/Department Head', tooltip: { english: 'e.g., Headmaster, Principal, Department Head', bengali: 'যেমন: প্রধান শিক্ষক, অধ্যক্ষ, বিভাগীয় প্রধান' } },
                { id: 'schoolOfficeName', label: { english: 'School/Office Name', bengali: 'বিদ্যালয়/কার্যালয়ের নাম' }, type: 'text', tooltip: { english: 'e.g., ABC High School, XYZ Department', bengali: 'যেমন: এবিসি উচ্চ বিদ্যালয়, এক্সওয়াইজেড বিভাগ' } },
                { id: 'address', label: { english: 'Address', bengali: 'ঠিকানা' }, type: 'text', tooltip: { english: 'Full address of your school/office', bengali: 'আপনার বিদ্যালয়/কার্যালয়ের সম্পূর্ণ ঠিকানা' } },
                { id: 'district', label: { english: 'District', bengali: 'জেলা' }, type: 'text', default: 'West Bengal', tooltip: { english: 'Your district in West Bengal', bengali: 'পশ্চিমবঙ্গের আপনার জেলা' } },
                { id: 'numDays', label: { english: 'Number of Days', bengali: 'দিনের সংখ্যা' }, type: 'number', min: 1, tooltip: { english: 'Number of days for leave', bengali: 'ছুটির দিনের সংখ্যা' } },
                { id: 'startDate', label: { english: 'Start Date', bengali: 'শুরুর তারিখ' }, type: 'date', tooltip: { english: 'First day of your leave', bengali: 'আপনার ছুটির প্রথম দিন' } },
                { id: 'endDate', label: { english: 'End Date', bengali: 'শেষের তারিখ' }, type: 'date', tooltip: { english: 'Last day of your leave', bengali: 'আপনার ছুটির শেষ দিন' } },
                {
                    id: 'reason',
                    label: { english: 'Reason for Leave', bengali: 'ছুটির কারণ' },
                    type: 'select',
                    options: [
                        { value: 'urgentPersonalMatter', english: 'Urgent Personal Matter', bengali: 'জরুরি ব্যক্তিগত কাজ' },
                        { value: 'familyEngagement', english: 'Family Engagement', bengali: 'পারিবারিক অনুষ্ঠান' },
                        { value: 'minorHealthIssue', english: 'Minor Health Issue', bengali: 'সামান্য অসুস্থতা' },
                        { value: 'other', english: 'Other (Please specify)', bengali: 'অন্যান্য (নির্দিষ্ট করুন)' }
                    ],
                    tooltip: { english: 'Select the primary reason for your leave', bengali: 'আপনার ছুটির প্রধান কারণ নির্বাচন করুন' }
                },
                { id: 'specificReason', label: { english: 'Specify Other Reason', bengali: 'অন্যান্য কারণ উল্লেখ করুন' }, type: 'text', dependsOn: { field: 'reason', value: 'other' }, optional: true, tooltip: { english: 'Provide details if you selected "Other"', bengali: 'আপনি "অন্যান্য" নির্বাচন করলে বিস্তারিত উল্লেখ করুন' } },
                { id: 'dateOfResumption', label: { english: 'Date of Resumption', bengali: 'কাজে যোগদানের তারিখ' }, type: 'date', tooltip: { english: 'Date when you will rejoin duty', bengali: 'আপনি যখন কাজে যোগ দেবেন সেই তারিখ' } },
                { id: 'yourName', label: { english: 'Your Name', bengali: 'আপনার নাম' }, type: 'text', tooltip: { english: 'Your full name as per records', bengali: 'রেকর্ড অনুযায়ী আপনার পুরো নাম' } },
                { id: 'designation', label: { english: 'Designation', bengali: 'পদবি' }, type: 'text', tooltip: { english: 'Your official designation', bengali: 'আপনার দাপ্তরিক পদবি' } },
                { id: 'employeeId', label: { english: 'Employee ID/Teacher ID', bengali: 'কর্মচারী আইডি/শিক্ষক আইডি' }, type: 'text', tooltip: { english: 'Your unique employee or teacher ID', bengali: 'আপনার অনন্য কর্মচারী বা শিক্ষক আইডি' } },
                { id: 'contactNumber', label: { english: 'Contact Number', bengali: 'যোগাযোগ নম্বর' }, type: 'tel', tooltip: { english: 'Your contact phone number', bengali: 'আপনার যোগাযোগের ফোন নম্বর' } },
            ]
        },
        {
            id: 'commutedLeave',
            name: { english: 'Commuted Leave (ML - Medical Leave)', bengali: 'অর্জিত ছুটি (ML - চিকিৎসা ছুটি)' },
            placeholders: [
                { id: 'authorityDesignation', label: { english: 'Authority Designation', bengali: 'কর্তৃপক্ষের পদবি' }, type: 'text', default: 'Headmaster/Principal/Department Head' },
                { id: 'schoolOfficeName', label: { english: 'School/Office Name', bengali: 'বিদ্যালয়/কার্যালয়ের নাম' }, type: 'text' },
                { id: 'address', label: { english: 'Address', bengali: 'ঠিকানা' }, type: 'text' },
                { id: 'district', label: { english: 'District', bengali: 'জেলা' }, type: 'text', default: 'West Bengal' },
                { id: 'numDays', label: { english: 'Number of Days', bengali: 'দিনের সংখ্যা' }, type: 'number', min: 1 },
                { id: 'startDate', label: { english: 'Start Date', bengali: 'শুরুর তারিখ' }, type: 'date' },
                { id: 'endDate', label: { english: 'End Date', bengali: 'শেষের তারিখ' }, type: 'date' },
                { id: 'medicalCondition', label: { english: 'Specific Medical Condition', bengali: 'নির্দিষ্ট অসুস্থতার কারণ' }, type: 'text', tooltip: { english: 'e.g., severe fever, viral infection', bengali: 'যেমন: তীব্র জ্বর, ভাইরাল সংক্রমণ' } },
                { id: 'dateOfRejoining', label: { english: 'Date of Rejoining', bengali: 'কাজে যোগদানের তারিখ' }, type: 'date' },
                { id: 'yourName', label: { english: 'Your Name', bengali: 'আপনার নাম' }, type: 'text' },
                { id: 'designation', label: { english: 'Designation', bengali: 'পদবি' }, type: 'text' },
                { id: 'employeeId', label: { english: 'Employee ID/Teacher ID', bengali: 'কর্মচারী আইডি/শিক্ষক আইডি' }, type: 'text' },
                { id: 'contactNumber', label: { english: 'Contact Number', bengali: 'যোগাযোগ নম্বর' }, type: 'tel' },
            ]
        },
        {
            id: 'childCareLeave',
            name: { english: 'Child Care Leave (CCL)', bengali: 'শিশু পরিচর্যা ছুটি (CCL)' },
            placeholders: [
                { id: 'authorityDesignation', label: { english: 'Authority Designation', bengali: 'কর্তৃপক্ষের পদবি' }, type: 'text', default: 'Headmaster/Principal/Department Head' },
                { id: 'schoolOfficeName', label: { english: 'School/Office Name', bengali: 'বিদ্যালয়/কার্যালয়ের নাম' }, type: 'text' },
                { id: 'address', label: { english: 'Address', bengali: 'ঠিকানা' }, type: 'text' },
                { id: 'district', label: { english: 'District', bengali: 'জেলা' }, type: 'text', default: 'West Bengal' },
                { id: 'numDays', label: { english: 'Number of Days', bengali: 'দিনের সংখ্যা' }, type: 'number', min: 1 },
                { id: 'startDate', label: { english: 'Start Date', bengali: 'শুরুর তারিখ' }, type: 'date' },
                { id: 'endDate', label: { english: 'End Date', bengali: 'শেষের তারিখ' }, type: 'date' },
                { id: 'childName', label: { english: "Child's Name", bengali: 'সন্তানের নাম' }, type: 'text' },
                { id: 'childAge', label: { english: "Child's Age (Years)", bengali: 'সন্তানের বয়স (বছর)' }, type: 'number', min: 0 },
                {
                    id: 'reasonForChildCare',
                    label: { english: 'Reason for Child Care', bengali: 'শিশুর পরিচর্যার কারণ' },
                    type: 'select',
                    options: [
                        { value: 'upcomingBoardExams', english: 'Upcoming Board Examinations', bengali: 'আসন্ন বোর্ড পরীক্ষা' },
                        { value: 'recentIllnessRecovery', english: 'Recent Illness and Recovery', bengali: 'সম্প্রতি অসুস্থতা এবং আরোগ্য' },
                        { value: 'specialMedicalAppointment', english: 'Special Medical Appointment', bengali: 'একটি বিশেষ চিকিৎসার অ্যাপয়েন্টমেন্ট' },
                        { value: 'other', english: 'Other (Please specify)', bengali: 'অন্যান্য (নির্দিষ্ট করুন)' }
                    ]
                },
                { id: 'specificChildCareReason', label: { english: 'Specify Other Reason', bengali: 'অন্যান্য কারণ উল্লেখ করুন' }, type: 'text', dependsOn: { field: 'reasonForChildCare', value: 'other' }, optional: true },
                { id: 'tasksHandled', label: { english: 'Tasks Handled/Completed (Optional)', bengali: 'সম্পন্ন/হস্তান্তর করা কাজ (ঐচ্ছিক)' }, type: 'text', optional: true, tooltip: { english: 'e.g., "all pending reports submitted"', bengali: 'যেমন: "সমস্ত বকেয়া রিপোর্ট জমা দেওয়া হয়েছে"' } },
                { id: 'yourName', label: { english: 'Your Name', bengali: 'আপনার নাম' }, type: 'text' },
                { id: 'designation', label: { english: 'Designation', bengali: 'পদবি' }, type: 'text' },
                { id: 'employeeId', label: { english: 'Employee ID/Teacher ID', bengali: 'কর্মচারী আইডি/শিক্ষক আইডি' }, type: 'text' },
                { id: 'contactNumber', label: { english: 'Contact Number', bengali: 'যোগাযোগ নম্বর' }, type: 'tel' },
            ]
        },
        {
            id: 'salaryBankChange',
            name: { english: 'Salary Bank Account Change', bengali: 'বেতন ব্যাংক অ্যাকাউন্ট পরিবর্তন' },
            placeholders: [
                { id: 'authorityDesignation', label: { english: 'Authority Designation', bengali: 'কর্তৃপক্ষের পদবি' }, type: 'text', default: 'Headmaster/Principal/Department Head' },
                { id: 'schoolOfficeName', label: { english: 'School/Office Name', bengali: 'বিদ্যালয়/কার্যালয়ের নাম' }, type: 'text' },
                { id: 'address', label: { english: 'Address', bengali: 'ঠিকানা' }, type: 'text' },
                { id: 'district', label: { english: 'District', bengali: 'জেলা' }, type: 'text', default: 'West Bengal' },
                { id: 'oldAccountNumber', label: { english: 'Old Account Number', bengali: 'পুরানো অ্যাকাউন্ট নম্বর' }, type: 'text' },
                { id: 'oldBankName', label: { english: 'Old Bank Name', bengali: 'পুরানো ব্যাংকের নাম' }, type: 'text' },
                { id: 'oldBranchName', label: { english: 'Old Branch Name', bengali: 'পুরানো শাখার নাম' }, type: 'text' },
                { id: 'oldIfscCode', label: { english: 'Old IFSC Code', bengali: 'পুরানো IFSC কোড' }, type: 'text' },
                {
                    id: 'reasonForChange',
                    label: { english: 'Reason for Change', bengali: 'পরিবর্তনের কারণ' },
                    type: 'select',
                    options: [
                        { value: 'accountClosure', english: 'Account Closure', bengali: 'অ্যাকাউন্ট বন্ধ হয়ে যাওয়া' },
                        { value: 'relocation', english: 'Relocation', bengali: 'স্থানান্তর' },
                        { value: 'betterFacilities', english: 'Better Banking Facilities', bengali: 'উন্নত ব্যাংকিং সুবিধা' },
                        { value: 'other', english: 'Other (Please specify)', bengali: 'অন্যান্য (নির্দিষ্ট করুন)' }
                    ]
                },
                { id: 'specificChangeReason', label: { english: 'Specify Other Reason', bengali: 'অন্যান্য কারণ উল্লেখ করুন' }, type: 'text', dependsOn: { field: 'reasonForChange', value: 'other' }, optional: true },
                { id: 'newAccountNumber', label: { english: 'New Account Number', bengali: 'নতুন অ্যাকাউন্ট নম্বর' }, type: 'text' },
                { id: 'newBankName', label: { english: 'New Bank Name', bengali: 'নতুন ব্যাংকের নাম' }, type: 'text' },
                { id: 'newBranchName', label: { english: 'New Branch Name', bengali: 'নতুন শাখার নাম' }, type: 'text' },
                { id: 'newIfscCode', label: { english: 'New IFSC Code', bengali: 'নতুন IFSC কোড' }, type: 'text' },
                { id: 'yourName', label: { english: 'Your Name', bengali: 'আপনার নাম' }, type: 'text' },
                { id: 'designation', label: { english: 'Designation', bengali: 'পদবি' }, type: 'text' },
                { id: 'employeeId', label: { english: 'Employee ID/Teacher ID', bengali: 'কর্মচারী আইডি/শিক্ষক আইডি' }, type: 'text' },
                { id: 'contactNumber', label: { english: 'Contact Number', bengali: 'যোগাযোগ নম্বর' }, type: 'tel' },
            ]
        },
        {
            id: 'ltcApplication',
            name: { english: 'Leave Travel Concession (LTC) Application', bengali: 'ছুটি ভ্রমণ সুবিধা (LTC) আবেদন' },
            placeholders: [
                { id: 'authorityDesignation', label: { english: 'Authority Designation', bengali: 'কর্তৃপক্ষের পদবি' }, type: 'text', default: 'Headmaster/Principal/Department Head' },
                { id: 'schoolOfficeName', label: { english: 'School/Office Name', bengali: 'বিদ্যালয়/কার্যালয়ের নাম' }, type: 'text' },
                { id: 'address', label: { english: 'Address', bengali: 'ঠিকানা' }, type: 'text' },
                { id: 'district', label: { english: 'District', bengali: 'জেলা' }, type: 'text', default: 'West Bengal' },
                { id: 'blockYear', label: { english: 'Block Year (e.g., 2022-2025)', bengali: 'ব্লক বছর (যেমন: ২০২২-২০২৫)' }, type: 'text' },
                { id: 'placeOfVisit', label: { english: 'Place of Visit', bengali: 'ভ্রমণের স্থান' }, type: 'text' },
                { id: 'familyMembers', label: { english: 'Family Members (e.g., wife, 2 children)', bengali: 'পরিবারের সদস্য (যেমন: স্ত্রী, ২ সন্তান)' }, type: 'text' },
                { id: 'startDate', label: { english: 'Proposed Start Date', bengali: 'প্রস্তাবিত শুরুর তারিখ' }, type: 'date' },
                { id: 'endDate', label: { english: 'Proposed End Date', bengali: 'প্রস্তাবিত শেষের তারিখ' }, type: 'date' },
                { id: 'modeOfTravel', label: { english: 'Mode of Travel', bengali: 'ভ্রমণের মাধ্যম' }, type: 'text', tooltip: { english: 'e.g., Train, Air', bengali: 'যেমন: ট্রেন, বিমান' } },
                { id: 'yourName', label: { english: 'Your Name', bengali: 'আপনার নাম' }, type: 'text' },
                { id: 'designation', label: { english: 'Designation', bengali: 'পদবি' }, type: 'text' },
                { id: 'employeeId', label: { english: 'Employee ID/Teacher ID', bengali: 'কর্মচারী আইডি/শিক্ষক আইডি' }, type: 'text' },
                { id: 'contactNumber', label: { english: 'Contact Number', bengali: 'যোগাযোগ নম্বর' }, type: 'tel' },
            ]
        },
        {
            id: 'gpfAdvance',
            name: { english: 'General Provident Fund (GPF) Advance Application', bengali: 'সাধারণ ভবিষ্যনিধি (GPF) অগ্রিম আবেদন' },
            placeholders: [
                { id: 'authorityDesignation', label: { english: 'Authority Designation', bengali: 'কর্তৃপক্ষের পদবি' }, type: 'text', default: 'Headmaster/Principal/Department Head' },
                { id: 'schoolOfficeName', label: { english: 'School/Office Name', bengali: 'বিদ্যালয়/কার্যালয়ের নাম' }, type: 'text' },
                { id: 'address', label: { english: 'Address', bengali: 'ঠিকানা' }, type: 'text' },
                { id: 'district', label: { english: 'District', bengali: 'জেলা' }, type: 'text', default: 'West Bengal' },
                { id: 'gpfAccountNumber', label: { english: 'GPF Account Number', bengali: 'GPF অ্যাকাউন্ট নম্বর' }, type: 'text' },
                {
                    id: 'reasonForAdvance',
                    label: { english: 'Reason for Advance', bengali: 'অগ্রিমের কারণ' },
                    type: 'select',
                    options: [
                        { value: 'houseConstruction', english: 'House Construction/Purchase', bengali: 'বাড়ি নির্মাণ/ক্রয়' },
                        { value: 'higherEducationChild', english: 'Higher Education of Child', bengali: 'সন্তানের উচ্চশিক্ষা' },
                        { value: 'medicalTreatment', english: 'Medical Treatment', bengali: 'চিকিৎসা' },
                        { value: 'marriageExpenses', english: 'Marriage Expenses', bengali: 'বিবাহের খরচ' },
                        { value: 'other', english: 'Other (Please specify)', bengali: 'অন্যান্য (নির্দিষ্ট করুন)' }
                    ]
                },
                { id: 'specificAdvanceReason', label: { english: 'Specify Other Reason', bengali: 'অন্যান্য কারণ উল্লেখ করুন' }, type: 'text', dependsOn: { field: 'reasonForAdvance', value: 'other' }, optional: true },
                { id: 'amountFigures', label: { english: 'Amount (Figures)', bengali: 'পরিমাণ (অঙ্কে)' }, type: 'number', min: 1 },
                { id: 'amountWords', label: { english: 'Amount (Words)', bengali: 'পরিমাণ (কথায়)' }, type: 'text', tooltip: { english: 'e.g., Five Thousand Only', bengali: 'যেমন: পাঁচ হাজার টাকা মাত্র' } },
                { id: 'yourName', label: { english: 'Your Name', bengali: 'আপনার নাম' }, type: 'text' },
                { id: 'designation', label: { english: 'Designation', bengali: 'পদবি' }, type: 'text' },
                { id: 'employeeId', label: { english: 'Employee ID/Teacher ID', bengali: 'কর্মচারী আইডি/শিক্ষক আইডি' }, type: 'text' },
                { id: 'contactNumber', label: { english: 'Contact Number', bengali: 'যোগাযোগ নম্বর' }, type: 'tel' },
            ]
        },
        {
            id: 'maternityLeave',
            name: { english: 'Maternity Leave Application', bengali: 'মাতৃত্বকালীন ছুটির আবেদন' },
            placeholders: [
                { id: 'authorityDesignation', label: { english: 'Authority Designation', bengali: 'কর্তৃপক্ষের পদবি' }, type: 'text', default: 'Headmaster/Principal/Department Head' },
                { id: 'schoolOfficeName', label: { english: 'School/Office Name', bengali: 'বিদ্যালয়/কার্যালয়ের নাম' }, type: 'text' },
                { id: 'address', label: { english: 'Address', bengali: 'ঠিকানা' }, type: 'text' },
                { id: 'district', label: { english: 'District', bengali: 'জেলা' }, type: 'text', default: 'West Bengal' },
                { id: 'expectedDeliveryDate', label: { english: 'Expected Date of Delivery', bengali: 'সম্ভাব্য প্রসবের তারিখ' }, type: 'date' },
                { id: 'numDaysWeeks', label: { english: 'Number of Days/Weeks', bengali: 'দিন/সপ্তাহের সংখ্যা' }, type: 'text', tooltip: { english: 'e.g., 180 days or 24 weeks', bengali: 'যেমন: ১৮০ দিন বা ২৪ সপ্তাহ' } },
                { id: 'startDate', label: { english: 'Start Date', bengali: 'শুরুর তারিখ' }, type: 'date' },
                { id: 'endDate', label: { english: 'End Date', bengali: 'শেষের তারিখ' }, type: 'date' },
                { id: 'yourName', label: { english: 'Your Name', bengali: 'আপনার নাম' }, type: 'text' },
                { id: 'designation', label: { english: 'Designation', bengali: 'পদবি' }, type: 'text' },
                { id: 'employeeId', label: { english: 'Employee ID/Teacher ID', bengali: 'কর্মচারী আইডি/শিক্ষক আইডি' }, type: 'text' },
                { id: 'contactNumber', label: { english: 'Contact Number', bengali: 'যোগাযোগ নম্বর' }, type: 'tel' },
            ]
        },
        {
            id: 'studyLeave',
            name: { english: 'Study Leave Application', bengali: 'অধ্যয়ন ছুটির আবেদন' },
            placeholders: [
                { id: 'authorityDesignation', label: { english: 'Authority Designation', bengali: 'কর্তৃপক্ষের পদবি' }, type: 'text', default: 'Headmaster/Principal/Department Head' },
                { id: 'schoolOfficeName', label: { english: 'School/Office Name', bengali: 'বিদ্যালয়/কার্যালয়ের নাম' }, type: 'text' },
                { id: 'address', label: { english: 'Address', bengali: 'ঠিকানা' }, type: 'text' },
                { id: 'district', label: { english: 'District', bengali: 'জেলা' }, type: 'text', default: 'West Bengal' },
                { id: 'numMonthsYears', label: { english: 'Number of Months/Years', bengali: 'মাস/বছরের সংখ্যা' }, type: 'text', tooltip: { english: 'e.g., 6 months, 2 years', bengali: 'যেমন: ৬ মাস, ২ বছর' } },
                { id: 'startDate', label: { english: 'Start Date', bengali: 'শুরুর তারিখ' }, type: 'date' },
                { id: 'endDate', label: { english: 'End Date', bengali: 'শেষের তারিখ' }, type: 'date' },
                { id: 'courseName', label: { english: 'Name of Course/Program', bengali: 'কোর্স/প্রোগ্রামের নাম' }, type: 'text', tooltip: { english: 'e.g., Master of Technology in Civil Engineering', bengali: 'যেমন: সিভিল ইঞ্জিনিয়ারিংয়ে মাস্টার অফ টেকনোলজি' } },
                { id: 'institutionName', label: { english: 'Name of Institution', bengali: 'প্রতিষ্ঠানের নাম' }, type: 'text', tooltip: { english: 'e.g., Jadavpur University', bengali: 'যেমন: যাদবপুর বিশ্ববিদ্যালয়' } },
                { id: 'relevantSkills', label: { english: 'Relevant Skills/Areas', bengali: 'প্রাসঙ্গিক দক্ষতা/ক্ষেত্রগুলি' }, type: 'text', tooltip: { english: 'e.g., project management, data analysis', bengali: 'যেমন: প্রকল্প ব্যবস্থাপনা, ডেটা বিশ্লেষণ' } },
                { id: 'serviceCommitmentYears', label: { english: 'Service Commitment (Years after study)', bengali: 'সেবা প্রতিশ্রুতি (অধ্যয়নের পর বছর)' }, type: 'number', min: 1, optional: true },
                { id: 'yourName', label: { english: 'Your Name', bengali: 'আপনার নাম' }, type: 'text' },
                { id: 'designation', label: { english: 'Designation', bengali: 'পদবি' }, type: 'text' },
                { id: 'employeeId', label: { english: 'Employee ID/Teacher ID', bengali: 'কর্মচারী আইডি/শিক্ষক আইডি' }, type: 'text' },
                { id: 'contactNumber', label: { english: 'Contact Number', bengali: 'যোগাযোগ নম্বর' }, type: 'tel' },
            ]
        },
    ];

    // Initialize formData with default values
    function initializeFormData() {
        console.log('[APP INIT] initializeFormData called.');
        formData = {};
        const selectedApp = applicationTypes.find(app => app.id === selectedApplicationType);
        if (selectedApp && selectedApp.placeholders) {
            selectedApp.placeholders.forEach(placeholder => {
                if (placeholder.default) {
                    formData[placeholder.id] = placeholder.default;
                } else if (placeholder.type === 'date') {
                    formData[placeholder.id] = new Date().toISOString().split('T')[0]; // Default to current date for date inputs
                } else if (placeholder.type === 'number') {
                    formData[placeholder.id] = ''; // Default empty for numbers
                } else if (placeholder.type === 'select' && placeholder.options.length > 0) {
                    formData[placeholder.id] = placeholder.options[0].value; // Default to first option
                } else {
                    formData[placeholder.id] = '';
                }
            });
        }
        console.log('[APP INIT] FormData after initialization:', formData);
    }

    // Helper function to format date to dd/mm/yyyy
    const formatDate = (dateString, lang) => {
        if (!dateString) return '';
        try {
            const date = new Date(dateString);
            // Use 'en-GB' locale for consistent dd/mm/yyyy format
            return date.toLocaleDateString('en-GB', {
                day: '2-digit',
                month: '2-digit',
                year: 'numeric'
            });
        } catch (e) {
            console.error("Error formatting date:", dateString, e);
            return dateString; // Return original if invalid
        }
    };

    // Function to generate the application text based on type and language
    const generateApplicationText = (type, lang, data) => {
        // Get current date for the application header in dd/mm/yyyy format
        const today = new Date();
        const currentDateFormatted = formatDate(today.toISOString().split('T')[0], lang); // Use helper for current date
        data.currentDate = currentDateFormatted; // Add current date to data for use in template

        const commonHeaderEnglish = `To,
The ${data.authorityDesignation || '[Designation of Authority]'},
${data.schoolOfficeName || '[School/Office Name]'},
${data.address || '[Address]'},
${data.district || '[District]'}, West Bengal

Date: ${data.currentDate || '[Current Date]'}`;

        const commonHeaderBengali = `প্রতি,
${data.authorityDesignation || '[কর্তৃপক্ষের পদবি]'},
${data.schoolOfficeName || '[বিদ্যালয়/কার্যালয়ের নাম]'},
${data.address || '[ঠিকানা]'},
${data.district || '[জেলা]'}, পশ্চিমবঙ্গ

তারিখ: ${data.currentDate || '[আজকের তারিখ]'}`;

        const commonFooterEnglish = `\nThanking You,

Yours faithfully,
${data.yourName || '[Your Name]'}
${data.designation || '[Designation]'}
${data.employeeId || '[Employee ID/Teacher ID]'}
${data.contactNumber || '[Contact Number]'}`;

        const commonFooterBengali = `\nধন্যবাদান্তে,

আপনার বিশ্বস্ত,
${data.yourName || '[আপনার নাম]'}
${data.designation || '[পদবি]'}
${data.employeeId || '[কর্মচারী আইডি/শিক্ষক আইডি]'}
${data.contactNumber || '[যোগাযোগ নম্বর]'}`;

        let body = '';

        switch (type) {
            case 'casualLeave':
                const clReasonEnglish = data.reason === 'other' ? data.specificReason : applicationTypes.find(a => a.id === type).placeholders.find(p => p.id === 'reason').options.find(o => o.value === data.reason)?.english;
                const clReasonBengali = data.reason === 'other' ? data.specificReason : applicationTypes.find(a => a.id === type).placeholders.find(p => p.id === 'reason').options.find(o => o.value === data.reason)?.bengali;

                if (lang === 'english') {
                    body = `Subject: Application for Casual Leave for ${data.numDays || '[Number]'} Day(s)

Respected Sir/Madam,

I am writing to request casual leave for ${data.numDays || '[Number]'} day(s) from ${formatDate(data.startDate, lang) || '[Start Date]'} to ${formatDate(data.endDate, lang) || '[End Date]'}. The reason for my leave is ${clReasonEnglish || '[Detailed Reason]'}.

I have completed all my urgent tasks and made necessary arrangements for my absence to ensure that the office work is not hampered. I will resume my duties on ${formatDate(data.dateOfResumption, lang) || '[Date of Resumption]'}.

I kindly request you to grant me the aforementioned leave.`;
                } else {
                    body = `বিষয়: ${data.numDays || '[সংখ্যা]'} দিনের নৈমিত্তিক ছুটির আবেদন

মহাশয়/মহাশয়া,

আমি ${formatDate(data.startDate, lang) || '[তারিখ]'} থেকে ${formatDate(data.endDate, lang) || '[তারিখ]'} পর্যন্ত ${data.numDays || '[সংখ্যা]'} দিনের নৈমিত্তিক ছুটির জন্য আবেদন করছি। আমার ছুটির কারণ হলো ${clReasonBengali || '[বিস্তারিত কারণ]'}।

আমি আমার সমস্ত জরুরি কাজ সম্পন্ন করেছি এবং আমার অনুপস্থিতিতে অফিসের কাজ যাতে ব্যাহত না হয় তার জন্য প্রয়োজনীয় ব্যবস্থা গ্রহণ করেছি। আমি ${formatDate(data.dateOfResumption, lang) || '[কাজে যোগদানের তারিখ]'} তারিখে আমার দায়িত্বে ফিরে আসব।

আমি আপনাকে উল্লিখিত ছুটি মঞ্জুর করার জন্য বিনীত অনুরোধ করছি।`;
                }
                break;
            case 'commutedLeave':
                if (lang === 'english') {
                    body = `Subject: Application for Commuted Leave (Medical Leave) for ${data.numDays || '[Number]'} Day(s)

Respected Sir/Madam,

I wish to apply for commuted leave for ${data.numDays || '[Number]'} day(s) from ${formatDate(data.startDate, lang) || '[Start Date]'} to ${formatDate(data.endDate, lang) || '[End Date]'}. I am suffering from ${data.medicalCondition || '[Specific Medical Condition]'} and have been advised by the doctor to take complete rest.

I will submit the medical certificate and fitness certificate upon my rejoining duty on ${formatDate(data.dateOfRejoining, lang) || '[Date of Rejoining]'}. I assure you that I will complete any pending work immediately after my return.

I humbly request you to sanction my commuted leave.`;
                } else {
                    body = `বিষয়: ${data.numDays || '[সংখ্যা]'} দিনের অর্জিত ছুটির (চিকিৎসা ছুটি) আবেদন

মহাশয়/মহাশয়া,

আমি ${formatDate(data.startDate, lang) || '[তারিখ]'} থেকে ${formatDate(data.endDate, lang) || '[তারিখ]'} পর্যন্ত ${data.numDays || '[সংখ্যা]'} দিনের অর্জিত ছুটির জন্য আবেদন করতে চাই। আমি ${data.medicalCondition || '[নির্দিষ্ট অসুস্থতার কারণ]'} এ ভুগছি এবং ডাক্তার আমাকে পূর্ণ বিশ্রামের পরামর্শ দিয়েছেন।

আমি ${formatDate(data.dateOfRejoining, lang) || '[কাজে যোগদানের তারিখ]'} তারিখে কর্মস্থলে যোগদানের পর মেডিকেল সার্টিফিকেট এবং ফিটনেস সার্টিফিকেট জমা দেব। আমি আপনাকে আশ্বাস দিচ্ছি যে ফিরে আসার পর আমি সমস্ত বকেয়া কাজ দ্রুত সম্পন্ন করব।

আমি আপনাকে আমার অর্জিত ছুটি মঞ্জুর করার জন্য বিনীত অনুরোধ করছি।`;
                }
                break;
            case 'childCareLeave':
                const cclReasonEnglish = data.reasonForChildCare === 'other' ? data.specificChildCareReason : applicationTypes.find(a => a.id === type).placeholders.find(p => p.id === 'reasonForChildCare').options.find(o => o.value === data.reasonForChildCare)?.english;
                const cclReasonBengali = data.reasonForChildCare === 'other' ? data.specificChildCareReason : applicationTypes.find(a => a.id === type).placeholders.find(p => p.id === 'reasonForChildCare').options.find(o => o.value === data.reasonForChildCare)?.bengali;

                if (lang === 'english') {
                    body = `Subject: Application for Child Care Leave for ${data.numDays || '[Number]'} Day(s)

Respected Sir/Madam,

I would like to apply for Child Care Leave for a period of ${data.numDays || '[Number]'} day(s) from ${formatDate(data.startDate, lang) || '[Start Date]'} to ${formatDate(data.endDate, lang) || '[End Date]'}. My child, ${data.childName || '[Child\'s Name]'}, aged ${data.childAge || '[Child\'s Age]'} years, requires my full-time care due to ${cclReasonEnglish || '[Detailed Reason for Child Care]'}.

${data.tasksHandled ? `I assure you that I will ensure all my official responsibilities are managed effectively during my absence. I have completed ${data.tasksHandled}.` : 'I assure you that I will ensure all my official responsibilities are managed effectively during my absence.'}

I kindly request you to sanction my Child Care Leave.`;
                } else {
                    body = `বিষয়: ${data.numDays || '[সংখ্যা]'} দিনের শিশু পরিচর্যা ছুটির আবেদন

মহাশয়/মহাশয়া,

আমি ${formatDate(data.startDate, lang) || '[তারিখ]'} থেকে ${formatDate(data.endDate, lang) || '[তারিখ]'} পর্যন্ত ${data.numDays || '[সংখ্যা]'} দিনের শিশু পরিচর্যা ছুটির জন্য আবেদন করতে চাই। আমার সন্তান, ${data.childName || '[সন্তানের নাম]'}, যার বয়স ${data.childAge || '[সন্তানের বয়স]'} বছর, ${cclReasonBengali || '[শিশুর পরিচর্যার বিস্তারিত কারণ]'} এর কারণে আমার পূর্ণকালীন পরিচর্যার প্রয়োজন।

${data.tasksHandled ? `আমি আপনাকে আশ্বাস দিচ্ছি যে আমার অনুপস্থিতিতে আমার সমস্ত দাপ্তরিক দায়িত্ব কার্যকরভাবে পরিচালিত হবে। আমি ${data.tasksHandled} সম্পন্ন করেছি।` : 'আমি আপনাকে আশ্বাস দিচ্ছি যে আমার অনুপস্থিতিতে আমার সমস্ত দাপ্তরিক দায়িত্ব কার্যকরভাবে পরিচালিত হবে।'}

I kindly request you to sanction my Child Care Leave.`;
                }
                break;
            case 'salaryBankChange':
                const sbcReasonEnglish = data.reasonForChange === 'other' ? data.specificChangeReason : applicationTypes.find(a => a.id === type).placeholders.find(p => p.id === 'reasonForChange').options.find(o => o.value === data.reasonForChange)?.english;
                const sbcReasonBengali = data.reasonForChange === 'other' ? data.specificChangeReason : applicationTypes.find(a => a.id === type).placeholders.find(p => p.id === 'reasonForChange').options.find(o => o.value === data.reasonForChange)?.bengali;

                if (lang === 'english') {
                    body = `Subject: Request for Change of Salary Bank Account Details

Respected Sir/Madam,

I am writing to formally request a change in my salary bank account details. My current salary is being credited to my account number ${data.oldAccountNumber || '[Old Account Number]'} with ${data.oldBankName || '[Old Bank Name]'}, ${data.oldBranchName || '[Old Branch Name]'}, IFSC Code: ${data.oldIfscCode || '[Old IFSC Code]'}.

Due to ${sbcReasonEnglish || '[Reason for Change]'}, I wish to update my salary credit to my new bank account. The details of my new bank account are as follows:
Account Holder Name: ${data.yourName || '[Your Name]'}
New Account Number: ${data.newAccountNumber || '[New Account Number]'}
Bank Name: ${data.newBankName || '[New Bank Name]'}
Branch Name: ${data.newBranchName || '[New Branch Name]'}
IFSC Code: ${data.newIfscCode || '[New IFSC Code]'}

I have attached a copy of my new bank passbook/cancelled cheque for your reference. Kindly process this request at your earliest convenience to ensure timely salary disbursement.`;
                } else {
                    body = `বিষয়: বেতন ব্যাংক অ্যাকাউন্ট পরিবর্তনের আবেদন

মহাশয়/মহাশয়া,

আমি আমার বেতন ব্যাংক অ্যাকাউন্টের বিবরণ পরিবর্তনের জন্য আনুষ্ঠানিকভাবে আবেদন করছি। আমার বর্তমান বেতন ${data.oldBankName || '[পুরানো ব্যাংক নাম]'}, ${data.oldBranchName || '[পুরানো শাখার নাম]'}, IFSC কোড: ${data.oldIfscCode || '[পুরানো IFSC কোড]'} এর ${data.oldAccountNumber || '[পুরানো অ্যাকাউন্ট নম্বর]'} অ্যাকাউন্টে জমা হচ্ছে।

${sbcReasonBengali || '[পরিবর্তনের কারণ]'} এর কারণে, আমি আমার বেতন নতুন ব্যাংক অ্যাকাউন্টে জমা করতে চাই। আমার নতুন ব্যাংক অ্যাকাউন্টের বিবরণ নিম্নরূপ:
অ্যাকাউন্টধারীর নাম: ${data.yourName || '[আপনার নাম]'}
নতুন অ্যাকাউন্ট নম্বর: ${data.newAccountNumber || '[নতুন অ্যাকাউন্ট নম্বর]'}
ব্যাংকের নাম: ${data.newBankName || '[নতুন ব্যাংকের নাম]'}
শাখার নাম: ${data.newBranchName || '[নতুন শাখার নাম]'}
IFSC কোড: ${data.newIfscCode || '[নতুন IFSC কোড]'}

আপনার রেফারেন্সের জন্য আমি আমার নতুন ব্যাংক পাসবুক/বাতিল করা চেকের একটি অনুলিপি সংযুক্ত করেছি। সময়মতো বেতন বিতরণের জন্য যত তাড়াতাড়ি সম্ভব এই অনুরোধটি প্রক্রিয়া করার জন্য বিনীত অনুরোধ করছি।`;
                }
                break;
            case 'ltcApplication':
                if (lang === 'english') {
                    body = `Subject: Application for Leave Travel Concession (LTC) for Block Year ${data.blockYear || '[Block Year]'}

Respected Sir/Madam,

I wish to apply for Leave Travel Concession (LTC) for the block year ${data.blockYear || '[Block Year]'}. I intend to avail LTC to visit ${data.placeOfVisit || '[Place of Visit]'} with my family members, namely ${data.familyMembers || '[List Family Members]'}.

The proposed period of leave for this travel is from ${formatDate(data.startDate, lang) || '[Start Date]'} to ${formatDate(data.endDate, lang) || '[End Date]'}. The mode of travel will be ${data.modeOfTravel || '[Mode of Travel]'}.

I kindly request you to sanction my LTC claim as per the prevailing rules and regulations. I shall submit all necessary bills and documents upon my return for reimbursement.`;
                } else {
                    body = `বিষয়: ${data.blockYear || '[ব্লক বছর]'} ব্লক বছরের জন্য ছুটি ভ্রমণ সুবিধা (LTC) এর আবেদন

মহাশয়/মহাশয়া,

আমি ${data.blockYear || '[ব্লক বছর]'} ব্লক বছরের জন্য ছুটি ভ্রমণ সুবিধা (LTC) এর জন্য আবেদন করতে চাই। আমি আমার পরিবারের সদস্যদের, যেমন ${data.familyMembers || '[পরিবারের সদস্যদের তালিকা]'} সহ ${data.placeOfVisit || '[ভ্রমণের স্থান]'} পরিদর্শনের জন্য LTC নিতে ইচ্ছুক।

এই ভ্রমণের জন্য প্রস্তাবিত ছুটির সময়কাল হলো ${formatDate(data.startDate, lang) || '[শুরুর তারিখ]'} থেকে ${formatDate(data.endDate, lang) || '[তারিখ]'} পর্যন্ত। ভ্রমণের মাধ্যম হবে ${data.modeOfTravel || '[ভ্রমণের মাধ্যম]'}।

আমি আপনাকে প্রচলিত নিয়মাবলী অনুযায়ী আমার LTC দাবি মঞ্জুর করার জন্য বিনীত অনুরোধ করছি। ফিরে আসার পর আমি সমস্ত প্রয়োজনীয় বিল এবং নথি জমা দেব।`;
                }
                break;
            case 'gpfAdvance':
                const gpfReasonEnglish = data.reasonForAdvance === 'other' ? data.specificAdvanceReason : applicationTypes.find(a => a.id === type).placeholders.find(p => p.id === 'reasonForAdvance').options.find(o => o.value === data.reasonForAdvance)?.english;
                const gpfReasonBengali = data.reasonForAdvance === 'other' ? data.specificAdvanceReason : applicationTypes.find(a => a.id === type).placeholders.find(p => p.id === 'reasonForAdvance').options.find(o => o.value === data.reasonForAdvance)?.bengali;

                if (lang === 'english') {
                    body = `Subject: Application for General Provident Fund (GPF) Advance

Respected Sir/Madam,

I would like to apply for an advance from my General Provident Fund (GPF) account. My GPF Account No. is ${data.gpfAccountNumber || '[GPF Account Number]'}.

The purpose of this advance is ${gpfReasonEnglish || '[Detailed Reason for Advance]'}. I require an advance amount of Rs. ${data.amountFigures || '[Amount in Figures]'}/- (Rupees ${data.amountWords || '[Amount in Words]'} only).

I assure you that the advance will be utilized solely for the stated purpose. I request you to kindly sanction the advance amount at your earliest convenience.`;
                } else {
                    body = `বিষয়: সাধারণ ভবিষ্যনিধি (GPF) অগ্রিমের জন্য আবেদন

মহাশয়/মহাশয়া,

আমি আমার সাধারণ ভবিষ্যনিধি (GPF) অ্যাকাউন্ট থেকে অগ্রিমের জন্য আবেদন করতে চাই। আমার GPF অ্যাকাউন্ট নম্বর ${data.gpfAccountNumber || '[GPF অ্যাকাউন্ট নম্বর]'}।

এই অগ্রিমের উদ্দেশ্য হলো ${gpfReasonBengali || '[অগ্রিমের বিস্তারিত কারণ]'}। আমার ${data.amountFigures || '[পরিমাণ অঙ্কে]'}/- (শুধুমাত্র ${data.amountWords || '[পরিমাণ কথায়]'} টাকা) অগ্রিম প্রয়োজন।

আমি আপনাকে আশ্বাস দিচ্ছি যে অগ্রিমটি শুধুমাত্র উল্লিখিত উদ্দেশ্যে ব্যবহার করা হবে। আপনার সুবিধামতো দ্রুত অগ্রিমের পরিমাণ মঞ্জুর করার জন্য বিনীত অনুরোধ করছি।`;
                }
                break;
            case 'maternityLeave':
                if (lang === 'english') {
                    body = `Subject: Application for Maternity Leave

Respected Sir/Madam,

I am writing to formally apply for Maternity Leave as per the rules and regulations. My expected date of delivery is ${formatDate(data.expectedDeliveryDate, lang) || '[Expected Date of Delivery]'}.

Therefore, I request a leave of ${data.numDaysWeeks || '[Number]'} days/weeks, starting from ${formatDate(data.startDate, lang) || '[Start Date]'} to ${formatDate(data.endDate, lang) || '[End Date]'}. I will ensure a proper handover of my responsibilities before going on leave.

I kindly request you to sanction my maternity leave and oblige.`;
                } else {
                    body = `বিষয়: মাতৃত্বকালীন ছুটির আবেদন

মহাশয়/মহাশয়া,

আমি নিয়মাবলী অনুযায়ী মাতৃত্বকালীন ছুটির জন্য আনুষ্ঠানিকভাবে আবেদন করছি। আমার সম্ভাব্য প্রসবের তারিখ ${formatDate(data.expectedDeliveryDate, lang) || '[সম্ভাব্য প্রসবের তারিখ]'}।

অতএব, আমি ${formatDate(data.startDate, lang) || '[তারিখ]'} থেকে ${formatDate(data.endDate, lang) || '[তারিখ]'} পর্যন্ত ${data.numDaysWeeks || '[সংখ্যা]'} দিন/সপ্তাহের ছুটির জন্য অনুরোধ করছি। আমি ছুটিতে যাওয়ার আগে আমার দায়িত্বগুলির সঠিক হস্তান্তর নিশ্চিত করব।

আমি আপনাকে আমার মাতৃত্বকালীন ছুটি মঞ্জুর করার জন্য বিনীত অনুরোধ করছি।`;
                }
                break;
            case 'studyLeave':
                if (lang === 'english') {
                    body = `Subject: Application for Study Leave for ${data.numMonthsYears || '[Number]'} Months/Years

Respected Sir/Madam,

I wish to apply for Study Leave for a period of ${data.numMonthsYears || '[Number]'} months/years, from ${formatDate(data.startDate, lang) || '[Start Date]'} to ${formatDate(data.endDate, lang) || '[End Date]'}. I intend to pursue ${data.courseName || '[Name of Course/Program]'} at ${data.institutionName || '[Name of Institution]'}.

This course is directly relevant to my professional development and will significantly enhance my skills in ${data.relevantSkills || '[mention relevant skills/areas]'}, which I believe will be beneficial for the department/organization upon my return. ${data.serviceCommitmentYears ? `I am committed to serving the department for a minimum of ${data.serviceCommitmentYears} years after the completion of my study.` : ''}

I kindly request you to consider my application and grant me the necessary study leave.`;
                } else {
                    body = `বিষয়: ${data.numMonthsYears || '[সংখ্যা]'} মাস/বছরের অধ্যয়ন ছুটির আবেদন

মহাশয়/মহাশয়া,

আমি ${formatDate(data.startDate, lang) || '[তারিখ]'} থেকে ${formatDate(data.endDate, lang) || '[তারিখ]'} পর্যন্ত ${data.numMonthsYears || '[সংখ্যা]'} মাস/বছরের অধ্যয়ন ছুটির জন্য আবেদন করতে চাই। আমি ${data.institutionName || '[প্রতিষ্ঠানের নাম]'} এ ${data.courseName || '[কোর্স/প্রোগ্রামের নাম]'} অধ্যয়ন করতে ইচ্ছুক।

এই কোর্সটি আমার পেশাগত বিকাশের সাথে সরাসরি সম্পর্কিত এবং ${data.relevantSkills || '[প্রাসঙ্গিক দক্ষতা/ক্ষেত্রগুলি উল্লেখ করুন]'} এ আমার দক্ষতা উল্লেখযোগ্যভাবে বৃদ্ধি করবে, যা আমি বিশ্বাস করি আমার ফিরে আসার পর বিভাগ/সংস্থার জন্য উপকারী হবে। ${data.serviceCommitmentYears ? `আমি অধ্যয়ন শেষ করার পর কমপক্ষে ${data.serviceCommitmentYears} বছর বিভাগে সেবা করার জন্য প্রতিশ্রুতিবদ্ধ।` : ''}

আমি আপনাকে আমার আবেদনটি বিবেচনা করে প্রয়োজনীয় অধ্যয়ন ছুটি মঞ্জুর করার জন্য বিনীত অনুরোধ করছি।`;
                }
                break;
            default:
                body = '';
        }

        const header = lang === 'english' ? commonHeaderEnglish : commonHeaderBengali;
        const footer = lang === 'english' ? commonFooterEnglish : commonFooterBengali;

        return `${header}\n\n${body}${footer}`;
    };

    // Function to update the application text and headings
    const updateApplicationText = () => {
        console.log('[UPDATE TEXT] updateApplicationText called.');
        applicationTextarea.value = generateApplicationText(selectedApplicationType, currentLanguage, formData);

        // Update headings based on selected language
        if (currentLanguage === 'english') {
            languageHeading.textContent = 'Select Language:';
            searchHeading.textContent = 'Search Application:';
            applicationTypeHeading.textContent = 'Select Application Type:';
            inputFieldsHeading.textContent = 'Enter Application Details:';
            generatedApplicationHeading.textContent = 'Generated Application:';
            copyButton.textContent = 'Copy Application';
            printButton.textContent = 'Print Application';
        } else {
            languageHeading.textContent = 'ভাষা নির্বাচন করুন:';
            searchHeading.textContent = 'আবেদন অনুসন্ধান করুন:';
            applicationTypeHeading.textContent = 'আবেদনের ধরন নির্বাচন করুন:';
            inputFieldsHeading.textContent = 'আবেদনের বিবরণ লিখুন:';
            generatedApplicationHeading.textContent = 'তৈরি করা আবেদন:';
            copyButton.textContent = 'আবেদন কপি করুন';
            printButton.textContent = 'আবেদন প্রিন্ট করুন';
        }
        console.log('[UPDATE TEXT] Application text and headings updated.');
    };

    // Function to render dynamic input fields
    const renderInputFields = () => {
        console.log('[RENDER INPUTS] renderInputFields called.');
        dynamicInputsContainer.innerHTML = ''; // Clear existing inputs
        const selectedApp = applicationTypes.find(app => app.id === selectedApplicationType);
        console.log('[RENDER INPUTS] Selected App for inputs:', selectedApp ? selectedApp.id : 'None');

        if (selectedApp && selectedApp.placeholders) {
            selectedApp.placeholders.forEach(placeholder => {
                // Conditional rendering for fields that depend on other fields
                if (placeholder.dependsOn && formData[placeholder.dependsOn.field] !== placeholder.dependsOn.value) {
                    return; // Skip rendering if dependency not met
                }

                const div = document.createElement('div');
                div.className = 'mb-4';

                const label = document.createElement('label');
                label.className = 'block text-sm font-medium text-gray-700 mb-1';
                label.textContent = placeholder.label[currentLanguage];
                div.appendChild(label);

                let inputElement;
                if (placeholder.type === 'select') {
                    inputElement = document.createElement('select');
                    placeholder.options.forEach(option => {
                        const opt = document.createElement('option');
                        opt.value = option.value;
                        opt.textContent = option[currentLanguage];
                        inputElement.appendChild(opt);
                    });
                    // Set default value for select
                    inputElement.value = formData[placeholder.id] || (placeholder.options.length > 0 ? placeholder.options[0].value : '');
                } else {
                    inputElement = document.createElement('input');
                    inputElement.type = placeholder.type;
                    inputElement.placeholder = placeholder.label[currentLanguage]; // Use label as placeholder
                    if (placeholder.min !== undefined) inputElement.min = placeholder.min;
                    // Set default value for other input types
                    inputElement.value = formData[placeholder.id] || '';
                }

                inputElement.id = `input-${placeholder.id}`;
                inputElement.className = 'w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-400 text-base';

                // Add event listener to update formData and application text
                inputElement.addEventListener('input', (event) => {
                    formData[placeholder.id] = event.target.value;
                    updateApplicationText();
                    // Re-render inputs if a dependency field changes (e.g., "Other" selected)
                    if (placeholder.id === 'reason' || placeholder.id === 'reasonForChildCare' || placeholder.id === 'reasonForChange' || placeholder.id === 'reasonForAdvance') {
                        renderInputFields();
                    }
                });

                div.appendChild(inputElement);

                if (placeholder.tooltip) {
                    const tooltip = document.createElement('p');
                    tooltip.className = 'text-xs text-gray-500 mt-1';
                    tooltip.textContent = placeholder.tooltip[currentLanguage];
                    div.appendChild(tooltip);
                }

                dynamicInputsContainer.appendChild(div);
            });
        }
        console.log('[RENDER INPUTS] Input fields rendering complete.');
    };

    // Function to render application type radio buttons based on filter
    const renderApplicationTypeRadios = (filterText = '') => {
        console.log('[RENDER RADIOS] renderApplicationTypeRadios called with filter:', filterText);
        applicationTypeRadiosContainer.innerHTML = ''; // Clear existing radios
        const lowerCaseFilter = filterText.toLowerCase();

        // Check if applicationTypes is empty
        if (applicationTypes.length === 0) {
            applicationTypeRadiosContainer.innerHTML = `<p class="text-gray-600">${currentLanguage === 'english' ? 'No application types defined.' : 'কোনো আবেদনের ধরন সংজ্ঞায়িত করা হয়নি।'}</p>`;
            console.warn('[RENDER RADIOS] applicationTypes array is empty. No radio buttons to render.');
            return;
        }

        const filteredTypes = applicationTypes.filter(appType =>
            appType.name.english.toLowerCase().includes(lowerCaseFilter) ||
            appType.name.bengali.toLowerCase().includes(lowerCaseFilter)
        );

        console.log('[RENDER RADIOS] Filtered Application Types count:', filteredTypes.length);
        console.log('[RENDER RADIOS] Attempting to render radio buttons.');

        if (filteredTypes.length === 0) {
            applicationTypeRadiosContainer.innerHTML = `<p class="text-gray-600">${currentLanguage === 'english' ? 'No applications found matching your search.' : 'আপনার অনুসন্ধানের সাথে মেলে এমন কোনো আবেদন পাওয়া যায়নি।'}</p>`;
            console.log('[RENDER RADIOS] No applications found after filtering.');
            return;
        }

        filteredTypes.forEach(appType => {
            const label = document.createElement('label');
            label.className = 'inline-flex items-center cursor-pointer bg-blue-100 p-4 rounded-lg shadow-md hover:bg-blue-200 transition-colors duration-200 border border-blue-300 w-full';

            const input = document.createElement('input');
            input.type = 'radio';
            input.className = 'form-radio h-5 w-5 text-blue-700 rounded-full focus:ring-2 focus:ring-blue-600';
            input.name = 'applicationType';
            input.value = appType.id;
            input.checked = (selectedApplicationType === appType.id);

            input.addEventListener('change', (event) => {
                selectedApplicationType = event.target.value;
                console.log('[EVENT] Application type changed to:', selectedApplicationType);
                initializeFormData(); // Re-initialize formData for new type
                renderInputFields(); // Re-render inputs for new type
                updateApplicationText();
            });

            const span = document.createElement('span');
            span.className = 'ml-3 text-lg font-medium text-blue-900';
            span.textContent = appType.name[currentLanguage];

            label.appendChild(input);
            label.appendChild(span);
            applicationTypeRadiosContainer.appendChild(label);
            console.log(`[RENDER RADIOS] Added radio button for: ${appType.name.english}`);
        });
        console.log('[RENDER RADIOS] Application type radios rendering complete.');
    };

    // Event listeners for language selection
    languageRadios.forEach(radio => {
        radio.addEventListener('change', (event) => {
            currentLanguage = event.target.value;
            console.log('[EVENT] Language changed to:', currentLanguage);
            renderApplicationTypeRadios(appSearchInput.value); // Re-render application types for language change
            renderInputFields(); // Re-render inputs for language change
            updateApplicationText();
        });
    });

    // Event listener for search input
    appSearchInput.addEventListener('input', (event) => {
        console.log('[EVENT] Search input changed:', event.target.value);
        renderApplicationTypeRadios(event.target.value);
    });

    // Function to copy text to clipboard
    const copyToClipboard = () => {
        applicationTextarea.select();
        try {
            document.execCommand('copy');
            copyMessage.textContent = currentLanguage === 'english' ? 'Copied to clipboard!' : 'ক্লিপবোর্ডে কপি করা হয়েছে!';
            console.log('[ACTION] Text copied to clipboard.');
        } catch (err) {
            copyMessage.textContent = currentLanguage === 'english' ? 'Failed to copy!' : 'কপি করতে ব্যর্থ!';
            console.error('[ERROR] Failed to copy text:', err);
        }
        setTimeout(() => copyMessage.textContent = '', 2000); // Clear message after 2 seconds
    };

    // Event listener for copy button
    copyButton.addEventListener('click', copyToClipboard);

    // Function to print the application
    const printApplication = () => {
        console.log('[ACTION] Print button clicked.');
        const printWindow = window.open('', '_blank');
        printWindow.document.write(`
            <html>
            <head>
                <title>${currentLanguage === 'english' ? 'Application Form' : 'আবেদনপত্র'}</title>
                <style>
                    body { font-family: 'Open Sans', sans-serif; margin: 20mm; line-height: 1.5; font-size: 12pt; }
                    pre { white-space: pre-wrap; word-wrap: break-word; }
                </style>
            </head>
            <body>
                <div id="print-area">
                    <pre>${applicationTextarea.value}</pre>
                </div>
                <script>
                    window.onload = function() {
                        window.print();
                        window.onafterprint = function() {
                            window.close();
                        };
                    };
                </scr` + `ipt>
            </body>
            </html>
        `);
        printWindow.document.close();
    };

    // Event listener for print button
    printButton.addEventListener('click', printApplication);

    // Initial render on page load
    document.addEventListener('DOMContentLoaded', () => {
        console.log('[APP INIT] DOM Content Loaded. Initializing app...');
        console.log('[APP INIT] Application types array length:', applicationTypes.length); // Check array length
        initializeFormData(); // Set initial default values
        renderApplicationTypeRadios(); // Render application types initially
        renderInputFields(); // Render initial input fields
        updateApplicationText(); // Generate initial application text
        console.log('[APP INIT] App initialization complete.');
    });
</script>
</body>
</html>
